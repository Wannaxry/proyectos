version: '2'

services:

  db:
    image: mariadb
    restart: always
    volumes:
      - db:/var/lib/mysql
    environment:
      - MYSQL_ROOT_PASSWORD=Islascanarias_22
      - MYSQL_PASSWORD=Islascanarias_22
      - MYSQL_DATABASE=wannacloud
      - MYSQL_USER=Wannacry

  app:
    image: nextcloud
    ports:
      - 80:80
    links:
      - db
    volumes:
      - nextcloud:/var/www/html
    environment:
      - MYSQL_ROOT_PASSWORD=Islascanarias_22
      - MYSQL_PASSWORD=Islascanarias_22
      - MYSQL_DATABASE=wannacloud
      - MYSQL_USER=Wannacry
      - NEXTCLOUD_ADMIN_USER=Wannacry
      - NEXTCLOUD_ADMIN_PASSWORD=Wannacry
    restart:
      always

  online:
    image: libreoffice/online:master
    environment:
      domain: cloud.jmlion.com
      username: Wannacry
      password: Islascanarias
      extra_params: --o:ssl.enable=false
      DONT_GEN_SSL_CERT: 1
    volumes:
      - config-volume:/etc/loolwsd
    cap_add:
      - MKNOD
    ports:
      - "9980:9980"
    restart:
      unless-stopped

volumes:
  config-volume:
  nextcloud:
  db: